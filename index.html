<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Trading y Dashboard ‚Äì Control Operativo Total</title>
    <link rel="stylesheet" href="patrones.css">
    <link rel="stylesheet" href="aditional.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/webp" href="/logoApp.webp">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'trading-bg': '#0f172a',
                        'trading-card': '#1e293b',
                        'gold': '#fbbf24',
                        'profit': '#10b981',
                        'loss': '#ef4444',
                        'neutral': '#6b7280'
                    }
                }
            }
        }
    </script>

</head>

<body class="bg-trading-bg text-white min-h-screen">
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold text-gold mb-4">Iniciar Sesi√≥n con Google</h3>
            <p class="text-gray-400 mb-6">Inicia sesi√≥n para sincronizar tus datos entre dispositivos</p>
            <button id="googleSignInBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg font-medium flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                    <path fill="white" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="white" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="white" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                    <path fill="white" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                Continuar con Google
            </button>
            <button id="continueOfflineBtn" class="w-full mt-3 bg-gray-600 hover:bg-gray-700 px-4 py-3 rounded-lg font-medium">
                Continuar Sin Sincronizaci√≥n
            </button>
            <p class="text-xs text-gray-500 mt-4 text-center">
                Tus datos se sincronizar√°n autom√°ticamente en todos tus dispositivos
            </p>
        </div>
    </div>

    <!-- Welcome Banner (shows user name for 20 seconds) -->
    <div id="welcomeBanner" class="fixed top-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 z-60 transform -translate-y-full transition-transform duration-500 hidden">
        <div class="container mx-auto flex items-center justify-center">
            <img id="welcomeUserPhoto" class="w-8 h-8 rounded-full mr-3" alt="User">
            <span class="text-sm font-medium">
                ¬°Bienvenido, <span id="welcomeUserName"></span>! Tus datos est√°n sincronizados.
            </span>
        </div>
    </div>

    <!-- User Menu / Google Login -->
    <div id="userSection" class="fixed top-4 right-4 z-40">
        <!-- Cuando no est√° logueado -->
        <div id="guestSection" class="bg-trading-card p-2 sm:p-3 rounded-lg border border-gray-700 flex items-center space-x-2 sm:space-x-3">
            <span class="text-xs sm:text-sm text-gray-300">Modo Invitado</span>
            <button id="topGoogleSignInBtn" class="bg-blue-600 hover:bg-blue-700 px-2 sm:px-3 py-1 sm:py-2 rounded-lg text-xs sm:text-sm font-medium flex items-center">
                <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1" viewBox="0 0 24 24">
                    <path fill="white" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="white" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="white" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                    <path fill="white" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                <span class="hidden sm:inline">Google</span>
            </button>
        </div>

        <!-- Cuando est√° logueado - Solo logo despu√©s del banner -->
        <div id="userMenu" class="bg-trading-card p-2 rounded-lg border border-gray-700 hidden">
            <div class="flex items-center space-x-2">
                <img id="userPhoto" class="w-6 h-6 sm:w-8 sm:h-8 rounded-full cursor-pointer" alt="User" title="Click para opciones">
                <div id="userDropdown" class="hidden absolute top-full right-0 mt-1 bg-trading-card border border-gray-600 rounded-lg p-2 shadow-lg min-w-48">
                    <div class="text-xs text-gray-300 mb-2" id="userNameInDropdown"></div>
                    <button id="signOutBtn" class="text-red-400 hover:text-red-300 text-xs w-full text-left">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Status -->
    <div id="syncStatus" class="fixed bottom-4 right-4 z-40 hidden">
        <div class="bg-trading-card p-2 rounded-lg border border-gray-700 flex items-center space-x-2 text-sm">
            <div id="syncIndicator" class="w-3 h-3 rounded-full bg-green-500"></div>
            <span id="syncText">Sincronizado</span>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-trading-card border-b border-gray-700 p-2 sm:p-4">
        <div class="container mx-auto flex flex-col">
            <h1 class="text-lg sm:text-2xl font-bold text-gold flex items-center">
                <span class="mr-1 sm:mr-2 text-base sm:text-2xl">üìä</span>
                <span class="hidden sm:inline">Trading Dashboard: Gestion y Control Operativo</span>
                <span class="sm:hidden">Trading Dashboard</span>
            </h1>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="text-xs sm:ms-10 ms-6 sm:text-sm text-gray-400">
                    <span id="currentTime">09/08/2025, 19:09</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-trading-card border-b border-gray-700">
        <div class="container mx-auto">
            <div class="flex space-x-0 overflow-x-auto">
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="dashboard">Dashboard</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="capital">Capital & Riesgo</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-gold text-gold whitespace-nowrap text-xs sm:text-base" data-tab="signals">Se√±ales y setup</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="trades">Registro Trades</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="trade-management">Gesti√≥n Trades</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="discipline">Disciplina</button>
                <button class="tab-btn px-3 sm:px-6 py-2 sm:py-3 font-medium border-b-2 border-transparent hover:text-gold whitespace-nowrap text-xs sm:text-base" data-tab="patterns">Patrones Velas</button>

            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-2 sm:p-4">
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content hidden">
            <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-8">
                <!-- Capital Actual -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold text-gold mb-1 sm:mb-2">Capital + P&L Total</h3>
                    <p class="text-lg sm:text-xl font-bold" id="dashCapital">$1,930</p>
                    <p class="text-xs text-gray-400 mt-1">Riesgo: <span id="dashRisk">$96.50</span></p>
                </div>

                <!-- Win Rate -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold text-profit mb-1 sm:mb-2">Win Rate</h3>
                    <p class="text-lg sm:text-xl font-bold" id="currentWinRate">0%</p>
                    <p class="text-xs text-gray-400 mt-1">Trades: <span id="totalTrades">0</span></p>
                </div>

                <!-- P&L Diario -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold mb-1 sm:mb-2">P&L Diario</h3>
                    <p class="text-lg sm:text-xl font-bold" id="dailyPnL">$0.00</p>
                    <p class="text-xs text-gray-400 mt-1">DD: <span id="drawdown">0%</span></p>
                </div>

                <!-- Trades Hoy -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold text-neutral mb-1 sm:mb-2">Trades Hoy</h3>
                    <p class="text-lg sm:text-xl font-bold" id="todayTrades">0</p>
                    <p class="text-xs text-gray-400 mt-1">L√≠mite: 4</p>
                </div>

                <!-- Retiros -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold text-orange-400 mb-1 sm:mb-2">Retiros</h3>
                    <p class="text-lg sm:text-xl font-bold" id="totalWithdrawals">$0.00</p>
                    <p class="text-xs text-gray-400 mt-1">Total</p>
                </div>

                <!-- P&L Total -->
                <div class="bg-trading-card p-3 sm:p-4 rounded-lg border border-gray-700">
                    <h3 class="text-xs sm:text-sm font-semibold text-blue-400 mb-1 sm:mb-2">P&L Total</h3>
                    <p class="text-lg sm:text-xl font-bold text-profit" id="totalPnL">$0.00</p>
                    <p class="text-xs text-gray-400 mt-1">Acumulado</p>
                </div>
            </div>

            <!-- Performance por Estrategia -->
            <div class="bg-trading-card p-4 sm:p-6 rounded-lg border border-gray-700 mb-4 sm:mb-6">
                <h3 class="text-lg sm:text-xl font-semibold text-gold mb-3 sm:mb-4">Performance por Estrategia</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                    <div class="strategy-stats" data-strategy="regulares">
                        <h4 class="font-semibold text-blue-400 text-sm sm:text-base">Trades Regulares</h4>
                        <div class="flex justify-between mt-2 text-xs sm:text-sm">
                            <span>Win Rate:</span>
                            <span class="strategy-winrate">0%</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>P&L:</span>
                            <span class="strategy-pnl">$0</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>Trades:</span>
                            <span class="strategy-count">0</span>
                        </div>
                    </div>
                    <div class="strategy-stats" data-strategy="ema-macd">
                        <h4 class="font-semibold text-purple-400 text-sm sm:text-base">EMA + MACD</h4>
                        <div class="flex justify-between mt-2 text-xs sm:text-sm">
                            <span>Win Rate:</span>
                            <span class="strategy-winrate">0%</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>P&L:</span>
                            <span class="strategy-pnl">$0</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>Trades:</span>
                            <span class="strategy-count">0</span>
                        </div>
                    </div>
                    <div class="strategy-stats" data-strategy="contra-tendencia">
                        <h4 class="font-semibold text-orange-400 text-sm sm:text-base">Contra-Tendencia</h4>
                        <div class="flex justify-between mt-2 text-xs sm:text-sm">
                            <span>Win Rate:</span>
                            <span class="strategy-winrate">0%</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>P&L:</span>
                            <span class="strategy-pnl">$0</span>
                        </div>
                        <div class="flex justify-between text-xs sm:text-sm">
                            <span>Trades:</span>
                            <span class="strategy-count">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agregar en el dashboard despu√©s de las m√©tricas principales -->
            <div class="bg-trading-card p-4 sm:p-6 rounded-lg border border-gray-700 mb-4 sm:mb-6">
                <h3 class="text-lg sm:text-xl font-semibold text-gold mb-3 sm:mb-4">Desglose de Capital</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-4">
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <h4 class="font-semibold text-blue-400 text-sm">Capital Base</h4>
                        <p class="text-lg font-bold" id="baseCapital">$0.00</p>
                        <p class="text-xs text-gray-400">Capital ingresado</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <h4 class="font-semibold text-profit text-sm">P&L Trading</h4>
                        <p class="text-lg font-bold" id="tradingPnL">$0.00</p>
                        <p class="text-xs text-gray-400">Ganancias/P√©rdidas</p>
                    </div>
                    <div class="bg-gray-800 p-3 rounded-lg">
                        <h4 class="font-semibold text-orange-400 text-sm">Capital Efectivo</h4>
                        <p class="text-lg font-bold" id="effectiveCapitalDisplay">$0.00</p>
                        <p class="text-xs text-gray-400">Base + P&L - Retiros</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Capital & Riesgo Tab -->
        <section id="capital" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Configuraci√≥n de Capital -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">Configuraci√≥n de Capital</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Capital Ingresado</label>
                            <input type="number" id="currentCapitalDisplay" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white" placeholder="Capital Actual" min="0" step="0.01" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Riesgo Diario M√°ximo (%) - Fijo: 5%</label>
                            <input type="number" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-gray-400" value="5" readonly>
                            <p class="text-xs text-gray-400 mt-1">Este es el l√≠mite total de p√©rdida por d√≠a</p>
                        </div>

                        <!-- Botones de gesti√≥n de capital -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                            <button id="addCapitalBtn" class="bg-profit hover:bg-green-600 px-4 py-3 rounded-lg font-medium flex items-center justify-center">
                                <span class="mr-2">üí∞</span>
                                Agregar Capital
                            </button>
                            <button id="withdrawalBtn" class="bg-orange-600 hover:bg-orange-700 px-4 py-3 rounded-lg font-medium flex items-center justify-center">
                                <span class="mr-2">üì§</span>
                                Registrar Retiro
                            </button>
                            <button id="resetCapitalBtn" class="bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg font-medium flex items-center justify-center">
                                <span class="mr-2">üîÑ</span>
                                Resetear Capital
                            </button>
                        </div>

                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-profit mb-2">C√°lculos Autom√°ticos</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span>Riesgo Diario M√°ximo:</span>
                                    <span id="maxDailyRisk" class="text-loss">$0.00</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>$ por pip (1 contrato):</span>
                                    <span class="text-gold">$1.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calculadora por Estrategia -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">Calculadora por Estrategia</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Seleccionar Estrategia</label>
                            <select id="strategySelect" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white">
                                <option value="regulares">Trades Regulares (1.5-2.5% del capital)</option>
                                <option value="ema-macd">EMA + MACD (3% del capital)</option>
                                <option value="contra-tendencia">Contra-Tendencia (2.5% del capital)</option>
                            </select>
                        </div>

                        <!-- Informaci√≥n de la Estrategia -->
                        <div class="bg-gray-900 p-4 rounded-lg border border-blue-500">
                            <h4 class="font-semibold text-blue-400 mb-3">üìà Info de Estrategia Seleccionada</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-400">Win Rate Hist√≥rico:</span>
                                    <p class="text-lg font-bold text-profit" id="strategyWinRate">55%</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Ratio R:R Promedio:</span>
                                    <p class="text-lg font-bold text-gold" id="strategyRR">2.2:1</p>
                                </div>
                                <div class="col-span-2">
                                    <span class="text-gray-400">% Riesgo Recomendado:</span>
                                    <p class="text-lg font-bold text-orange-400" id="strategyRiskPercent">2.0%</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-gold mb-3">üí∞ Par√°metros Calculados</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="col-span-2 bg-gray-900 p-3 rounded-lg border-l-4 border-red-400">
                                    <span class="text-gray-400">Riesgo M√°ximo por Trade:</span>
                                    <p class="text-xl font-bold text-loss" id="maxRiskPerTrade">$0</p>
                                </div>

                                <div>
                                    <span class="text-gray-400">Contratos √ìptimos:</span>
                                    <p class="text-lg font-bold" id="optimalContracts">0</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Stop Loss Sugerido:</span>
                                    <p class="text-lg font-bold" id="suggestedSL">6 pips</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Take Profit 1:</span>
                                    <p class="text-lg font-bold text-profit" id="takeProfit1">13 pips</p>
                                </div>
                                <div>
                                    <span class="text-gray-400">Take Profit 2:</span>
                                    <p class="text-lg font-bold text-profit" id="takeProfit2">24 pips</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registro de Trades Tab -->
        <section id="trades" class="tab-content hidden">
            <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h3 class="text-xl font-semibold text-gold">Registro de Trades</h3>
                    <div class="flex flex-row gap-2">
                        <button id="addTradeBtn" class="bg-profit hover:bg-green-600 px-4 py-2 rounded-lg font-medium">
                            + Nuevo Trade
                        </button>
                        <button id="exportTradesBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium">
                            üìä Exportar CSV
                        </button>
                        <button id="activeTradesBtn" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg font-medium" onclick="showClosureManagement()">
                            ‚ö°Gesti√≥n de Cierre
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                    <select id="filterStrategy" class="p-2 bg-gray-800 border border-gray-600 rounded-lg text-white">
                        <option value="">Todas las estrategias</option>
                        <option value="regulares">Trades Regulares</option>
                        <option value="ema-macd">EMA + MACD</option>
                        <option value="contra-tendencia">Contra-Tendencia</option>
                    </select>
                    <select id="filterResult" class="p-2 bg-gray-800 border border-gray-600 rounded-lg text-white">
                        <option value="all" selected>Todos</option>
                        <option value="open">Abiertos</option>
                        <option value="win">Ganadores</option>
                        <option value="loss">Perdedores</option>
                    </select>
                    <input type="date" id="filterDate" class="p-2 bg-gray-800 border border-gray-600 rounded-lg text-white">
                </div>

                <!-- Tabla de Trades - CORREGIDA -->
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="text-left p-3 text-gold">Fecha</th>
                                <th class="text-left p-3 text-gold">Estrategia</th>
                                <th class="text-left p-3 text-gold">Direcci√≥n</th>
                                <th class="text-left p-3 text-gold">Contratos</th>
                                <th class="text-left p-3 text-gold">Precio Apert.</th>
                                <th class="text-left p-3 text-gold">Precio Cierre</th>
                                <th class="text-left p-3 text-gold">Estado</th>
                                <th class="text-left p-3 text-gold">P&L ($)</th>
                                <th class="text-left p-3 text-gold">Comentarios</th>
                                <th class="text-left p-3 text-gold">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTableBody">
                            <!-- Trades ser√°n insertados aqu√≠ din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Check y estrategias Tab -->
        <section id="signals" class="tab-content p-6">
            <!-- PRIMERA FILA: Setup Checker + Strategy Cards (Compra/Venta) -->
            <div class="grid grid-cols-1 lg:grid-cols-[42%_58%] gap-6 mb-6">
                <div class="lg:col-span-1">
                    <article class="bg-trading-card p-6 rounded-lg border border-gray-700 h-full">
                        <!-- Header con selector de estrategia -->
                        <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                            <h3 class="text-xl font-semibold text-gold">üìà Setup Checker</h3>
                            <div class="flex items-center gap-2 w-full sm:w-auto">
                                <label for="signalStrategySelect" class="sr-only">Seleccionar Estrategia</label>
                                <select id="signalStrategySelect" class="p-3 bg-gray-800 border border-gray-600 rounded-lg text-white min-w-64 text-sm font-medium">
                                    <option value="regulares">üìà Estrategia 1: Trades Regulares</option>
                                    <option value="ema-macd">üìä Estrategia 2: EMA + MACD</option>
                                    <option value="contra-tendencia">‚ö° Estrategia 3: Contra Tendencia</option>
                                </select>
                            </div>
                        </header>

                        <!-- Informaci√≥n r√°pida de la estrategia -->
                        <div id="quickStrategyInfo" class="grid grid-cols-4 gap-2 mb-6">
                            <div class="bg-gray-800 p-2 rounded text-center">
                                <div id="strategyWinRateQuick" class="text-lg font-bold text-profit">55%</div>
                                <div class="text-xs text-gray-400">Win Rate</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded text-center">
                                <div id="strategyRRQuick" class="text-lg font-bold text-blue-400">2.2:1</div>
                                <div class="text-xs text-gray-400">R:R</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded text-center">
                                <div id="strategyRiskQuick" class="text-lg font-bold text-orange-400">2.0%</div>
                                <div class="text-xs text-gray-400">Risk</div>
                            </div>
                            <div class="bg-gray-800 p-2 rounded text-center">
                                <div id="optimalContractsQuick" class="text-lg font-bold text-gold">0</div>
                                <div class="text-xs text-gray-400">Contratos</div>
                            </div>
                        </div>

                        <!-- Contenido din√°mico del setup checker (checklist) -->
                        <div id="setupCheckerContent" aria-live="polite" class="mb-2 flex-1">
                            <!-- El checklist se generar√° din√°micamente aqu√≠ -->
                        </div>

                        <!-- Score y botones -->
                        <footer id="setupScore" class="mt-auto">
                            <div class="text-center mb-4">
                                <div id="scoreValue" class="text-3xl font-bold text-gray-400 mb-2" aria-live="polite">0%</div>
                                <div class="w-full bg-gray-700 rounded-full h-4 mb-2" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                    <div id="scoreBar" class="h-4 rounded-full bg-gray-600 transition-all duration-500" style="width: 0%"></div>
                                </div>
                                <div id="setupFeedback" class="text-sm text-gray-400 text-center mb-3 hidden"></div>
                            </div>

                            <!-- Botones de acci√≥n -->
                            <div class="flex space-x-3">
                                <button id="executeSetupBtn" class="flex-1 bg-gray-600 px-4 py-3 rounded-lg font-medium cursor-not-allowed opacity-75" disabled>
                                    <span class="flex items-center justify-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                        <span>Necesario 70%+ (0%)</span>
                                    </span>
                                </button>
                                <button id="discardSetupBtn" class="flex-1 bg-loss hover:bg-red-600 px-2 py-1 rounded-lg font-medium transition-all duration-200">
                                    <span class="flex items-center justify-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                        <span> Reiniciar</span>
                                    </span>
                                </button>
                            </div>
                        </footer>
                    </article>
                </div>

                <!-- STRATEGY TEMPLATES DISPLAY - DERECHA (50%) -->
                <div class="lg:col-span-1">
                    <article class="bg-trading-card p-6 rounded-lg border border-gray-700 h-full">
                        <h3 class="text-xl font-semibold text-gold mb-4">üéØ Setup Actual</h3>

                        <!-- Contenedor para mostrar los templates de estrategia -->
                        <div id="strategyTemplateDisplay" class="h-full overflow-y-auto">
                            <!-- Los templates se mostrar√°n aqu√≠ din√°micamente -->
                        </div>
                    </article>
                </div>
            </div>

            <!-- SEGUNDA FILA: Sistema MACD (Izquierda) + Niveles Cr√≠ticos (Derecha) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <!-- SISTEMA MACD - IZQUIERDA -->
                <section class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-xl shadow-lg border border-slate-400">
                    <h3 class="text-xl font-bold text-indigo-300 mb-4 flex items-center">
                        <span class="text-2xl mr-3">üìä</span>
                        Sistema MACD - Confluencias Esenciales
                    </h3>

                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <article class="bg-slate-800 bg-opacity-60 p-5 rounded-lg border border-slate-600">
                            <h4 class="font-bold text-indigo-200 mb-4">‚öôÔ∏è Configuraci√≥n y Jerarqu√≠a</h4>
                            <div class="space-y-3">
                                <div class="bg-indigo-700 bg-opacity-50 p-3 rounded">
                                    <div class="font-semibold text-indigo-100 mb-2">Par√°metros: MACD (12,26,9)</div>
                                </div>

                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between items-center bg-indigo-700 bg-opacity-30 p-3 rounded border-l-4 border-red-400">
                                        <span class="font-medium">MACD 4H: Contexto direccional</span>
                                        <span class="text-red-300 font-bold text-lg">80%</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-indigo-700 bg-opacity-30 p-3 rounded border-l-4 border-yellow-400">
                                        <span class="font-medium">MACD 1H: Se√±al entrada</span>
                                        <span class="text-yellow-400 font-bold text-lg">15%</span>
                                    </div>
                                    <div class="flex justify-between items-center bg-indigo-700 bg-opacity-30 p-3 rounded border-l-4 border-blue-400">
                                        <span class="font-medium">MACD 15M: Timing ejecuci√≥n</span>
                                        <span class="text-blue-400 font-bold text-lg">5%</span>
                                    </div>
                                </div>
                            </div>
                        </article>

                        <article class="bg-slate-800 bg-opacity-60 p-5 rounded-lg border border-slate-600">
                            <h4 class="font-bold text-slate-200 mb-4">üéØ Se√±ales Cr√≠ticas</h4>
                            <div class="space-y-4">
                                <section>
                                    <h5 class="font-semibold text-amber-400 mb-3">Divergencias Clave:</h5>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex items-start bg-red-900 bg-opacity-30 p-2 rounded">
                                            <span class="text-red-400 font-bold mr-2">üìâ</span>
                                            <span><strong class="text-red-300">Bajista:</strong> Precio ‚Üë, MACD ‚Üì ‚Üí Preparar VENTAS</span>
                                        </div>
                                        <div class="flex items-start bg-green-900 bg-opacity-30 p-2 rounded">
                                            <span class="text-green-400 font-bold mr-2">üìà</span>
                                            <span><strong class="text-green-300">Alcista:</strong> Precio ‚Üì, MACD ‚Üë ‚Üí Preparar COMPRAS</span>
                                        </div>
                                        <div class="flex items-start bg-blue-900 bg-opacity-30 p-2 rounded">
                                            <span class="text-blue-400 font-bold mr-2">‚úÖ</span>
                                            <span><strong class="text-blue-300">Validaci√≥n:</strong> M√≠nimo 2 timeframes alineados</span>
                                        </div>
                                    </div>
                                </section>

                                <section>
                                    <h5 class="font-semibold text-purple-400 mb-3">Cruces V√°lidos:</h5>
                                    <div class="space-y-1 text-sm">
                                        <div class="bg-purple-900 bg-opacity-30 p-2 rounded">
                                            <span>‚Ä¢ Solo si 4H y 1H est√°n alineados</span>
                                        </div>
                                        <div class="bg-purple-900 bg-opacity-30 p-2 rounded">
                                            <span>‚Ä¢ Histograma debe acompa√±ar el cruce</span>
                                        </div>
                                    </div>
                                </section>
                            </div>

                            <div class="bg-red-900 bg-opacity-40 p-3 rounded-lg border border-red-400 mt-4">
                                <p class="text-sm text-red-200 font-medium">
                                    <span class="font-bold text-red-300">‚ö†Ô∏è CR√çTICO:</span>
                                    Nunca operar contra MACD 4H (excepto estrategia 3)
                                </p>
                            </div>
                        </article>
                    </div>
                </section>

                <!-- NIVELES CR√çTICOS - DERECHA -->
                <article class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">üéØ Niveles Cr√≠ticos Oro - Actualizados</h3>
                    <div class="space-y-4">
                        <section>
                            <h4 class="font-semibold text-loss mb-3">üî¥ Resistencias Clave</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,485.0</span>
                                    <span class="text-loss text-xs">M√°ximo Hist√≥rico ¬±8 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,450.0</span>
                                    <span class="text-loss text-xs">Resistencia Fuerte ¬±6 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,431.0</span>
                                    <span class="text-loss text-xs">Hist√≥rica M√∫ltiple ¬±5 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,420.0</span>
                                    <span class="text-loss text-xs">Distribuci√≥n Clave ¬±6 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,401.0</span>
                                    <span class="text-orange-400 text-xs">Psicol√≥gica Mayor ¬±5 pips</span>
                                </div>
                            </div>
                        </section>
                        <section>
                            <h4 class="font-semibold text-profit mb-3">üü¢ Soportes Clave</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,240.0</span>
                                    <span class="text-profit text-xs">Soporte Mayor ¬±12 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,269.0</span>
                                    <span class="text-profit text-xs">T√©cnico Validado ¬±8 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,280.0</span>
                                    <span class="text-profit text-xs">Demanda Institucional ¬±6 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,296.0</span>
                                    <span class="text-profit text-xs">Zona Cr√≠tica ¬±7 pips</span>
                                </div>
                                <div class="flex justify-between bg-gray-800 p-2 rounded">
                                    <span class="font-mono">2,300-2,310</span>
                                    <span class="text-orange-400 text-xs">Psicol√≥gico Fuerte ¬±5 pips</span>
                                </div>
                            </div>
                        </section>
                    </div>
                    <footer class="mt-4 pt-4 border-t border-gray-700">
                        <button id="editLevelsBtn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium text-sm">
                            ‚úèÔ∏è Actualizar Niveles
                        </button>
                        <span class="text-xs text-gray-400 ml-3">√öltima actualizaci√≥n: <span id="levelsLastUpdate">Hoy</span></span>
                    </footer>
                </article>
            </div>
        </section>

        <!-- Gesti√≥n Trades Tab -->
        <section id="trade-management" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Protocolo de Monitoreo -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">üìä Protocolo de Monitoreo</h3>
                    <div class="space-y-4">
                        <div class="bg-slate-800 bg-opacity-60 p-4 rounded-lg border border-slate-600">
                            <h4 class="font-semibold text-slate-300 mb-2">Primeros 15 Minutos</h4>
                            <ul class="text-sm space-y-1">
                                <li>‚Ä¢ Verificar que precio se mueve en direcci√≥n esperada</li>
                                <li>‚Ä¢ Si va contra: permitir hasta SL sin modificaciones</li>
                                <li>‚Ä¢ Si va a favor: mantener configuraci√≥n original</li>
                            </ul>
                        </div>
                        <div class="bg-gray-800 bg-opacity-70 p-4 rounded-lg border border-gray-600">
                            <h4 class="font-semibold text-green-400 mb-2">Al Alcanzar TP1 (60% posici√≥n)</h4>
                            <ul class="text-sm space-y-1">
                                <li>‚Ä¢ Cerrar autom√°ticamente 60% de contratos</li>
                                <li>‚Ä¢ Mover SL a breakeven + 2 pips en posici√≥n restante</li>
                                <li>‚Ä¢ Activar trail stop de 8 pips para TP2</li>
                            </ul>
                        </div>
                        <div class="bg-zinc-800 bg-opacity-60 p-4 rounded-lg border border-zinc-600">
                            <h4 class="font-semibold text-orange-400 mb-2">Salidas Tempranas</h4>
                            <ul class="text-sm space-y-1">
                                <li>‚Ä¢ Williams %R volviendo 80% hacia extremo original</li>
                                <li>‚Ä¢ MACD mostrando divergencia fuerte contra posici√≥n</li>
                                <li>‚Ä¢ Volumen decayendo significativamente por 3+ velas</li>
                                <li>‚Ä¢ Aparici√≥n de noticias cr√≠ticas inesperadas</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Control Semanal -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">üìà Control Semanal</h3>
                    <div class="space-y-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-gold mb-3">M√©tricas a Monitorear</h4>
                            <div class="space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span>Win Rate por Estrategia:</span>
                                    <span class="text-blue-400">Comparar vs objetivo</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Ganancia Promedio:</span>
                                    <span class="text-green-400">Media >= $50/dia</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Drawdown M√°ximo:</span>
                                    <span class="text-red-400">No exceder 15% semanal</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Trades por D√≠a:</span>
                                    <span class="text-yellow-400">Promedio 2, m√°x 3</span>
                                </div>
                            </div>
                        </div>
                        <button id="weeklyAnalysisBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium">
                            üìä Generar An√°lisis Semanal
                        </button>
                    </div>
                </div>
            </div>

            <!-- An√°lisis Post-Trade -->
            <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                <h3 class="text-xl font-semibold text-gold mb-4">üîç An√°lisis Post-Trade</h3>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-blue-400 mb-2">Setup Ejecutado</h5>
                        <p class="text-xs">¬øCumpli√≥ todos los criterios?</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-green-400 mb-2">Timing</h5>
                        <p class="text-xs">¬øFue en horario √≥ptimo?</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-yellow-400 mb-2">Gesti√≥n</h5>
                        <p class="text-xs">¬øRespet√≥ SL y TP?</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-purple-400 mb-2">Contexto</h5>
                        <p class="text-xs">¬øMercado como esperado?</p>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg text-center">
                        <h5 class="font-semibold text-orange-400 mb-2">Mejoras</h5>
                        <p class="text-xs">¬øQu√© optimizar?</p>
                    </div>
                </div>
                <div class="mt-4">
                    <textarea id="postTradeAnalysis" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white h-24" placeholder="An√°lisis detallado del trade: setup, timing, gesti√≥n, contexto y mejoras..."></textarea>
                    <button id="savePostTradeBtn" class="mt-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-medium">
                        üíæ Guardar An√°lisis
                    </button>
                </div>
            </div>
        </section>

        <!-- Disciplina Tab -->
        <section id="discipline" class="tab-content hidden">
            <!-- Reglas Inquebrantables -->
            <div class="bg-trading-card p-6 mb-8 rounded-lg border border-gray-700 mt-6">
                <h3 class="text-xl font-semibold text-loss mb-4">üö® Reglas Inquebrantables</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-loss mb-3">NUNCA:</h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start">
                                <span class="text-loss mr-2">‚ùå</span>
                                <span>Exceder 5% de riesgo diario total</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-loss mr-2">‚ùå</span>
                                <span>Operar en zonas medias sin validaci√≥n</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-loss mr-2">‚ùå</span>
                                <span>Comprar arriba o vender abajo</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-loss mr-2">‚ùå</span>
                                <span>Aumentar riesgo moviendo el SL</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-loss mr-2">‚ùå</span>
                                <span>Operar sin confirmaci√≥n o por emociones</span>
                            </li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-profit mb-3">SIEMPRE:</h4>
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start">
                                <span class="text-profit mr-2">‚úÖ</span>
                                <span>Operar a favor de tendencia</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-profit mr-2">‚úÖ</span>
                                <span>Respetar protocolo de p√©rdidas consecutivas</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-profit mr-2">‚úÖ</span>
                                <span>Configurar SL y TP antes de ejecutar</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-profit mr-2">‚úÖ</span>
                                <span>Ingresar al final de retroceso validado</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-profit mr-2">‚úÖ</span>
                                <span>Priorizar consistencia sobre grandes ganancias</span>
                            </li>
                        </ul>
                    </div>

                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Control de Disciplina -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">Control de Disciplina</h3>
                    <div class="space-y-4">
                        <div class="bg-gray-800 p-4 rounded-lg">
                            <h4 class="font-semibold text-profit mb-3">Indicadores de Cumplimiento</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span>Respeto a Stop Loss:</span>
                                    <div class="flex items-center">
                                        <div id="slDiscipline" class="w-4 h-4 rounded-full bg-profit mr-2"></div>
                                        <span id="slPercentage">100%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>L√≠mite Diario:</span>
                                    <div class="flex items-center">
                                        <div id="limitDiscipline" class="w-4 h-4 rounded-full bg-profit mr-2"></div>
                                        <span id="limitPercentage">100%</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>Gesti√≥n de Riesgo:</span>
                                    <div class="flex items-center">
                                        <div id="riskDiscipline" class="w-4 h-4 rounded-full bg-profit mr-2"></div>
                                        <span id="riskPercentage">100%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-700">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">Disciplina General:</span>
                                    <span id="overallDiscipline" class="text-2xl font-bold text-profit">100%</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-3 mt-2">
                                    <div id="disciplineBar" class="h-3 rounded-full bg-profit transition-all duration-300" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Registro de Observaciones -->
                <div class="bg-trading-card p-6 rounded-lg border border-gray-700">
                    <h3 class="text-xl font-semibold text-gold mb-4">Observaciones Post-Trade</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nueva Observaci√≥n</label>
                            <textarea id="observationInput" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white h-24" placeholder="Describe qu√© funcion√≥, qu√© no funcion√≥, y mejoras para el pr√≥ximo trade..."></textarea>
                        </div>
                        <button id="addObservationBtn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium">
                            üìù Agregar Observaci√≥n
                        </button>
                        <div id="observationsList" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- Observaciones ser√°n insertadas aqu√≠ -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Patrones Tab -->
        <section id="patterns" class="tab-content hidden">
            <div class="bg-trading-dark border-b border-slate-700">
                <div class="max-w-7xl mx-auto px-4 py-6">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                        <div>
                            <h1 class="text-3xl font-bold text-yellow-400 flex items-center gap-3 mb-2">
                                üìä Patrones de Velas Japonesas
                            </h1>
                            <p class="text-slate-400 text-base">
                                Sistema avanzado de reconocimiento y an√°lisis de patrones para trading profesional
                            </p>
                        </div>

                        <!-- M√©tricas de rendimiento -->
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 w-full lg:w-auto">
                            <div class="stats-card rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-green-400" id="totalPatterns">12</div>
                                <div class="text-xs text-slate-400">Patrones</div>
                            </div>
                            <div class="stats-card rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-blue-400" id="avgReliability">78%</div>
                                <div class="text-xs text-slate-400">Confiabilidad</div>
                            </div>
                            <div class="stats-card rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-purple-400" id="reversalCount">8</div>
                                <div class="text-xs text-slate-400">Reversi√≥n</div>
                            </div>
                            <div class="stats-card rounded-lg p-3 text-center">
                                <div class="text-2xl font-bold text-cyan-400" id="continuationCount">4</div>
                                <div class="text-xs text-slate-400">Continuaci√≥n</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="max-w-7xl mx-auto px-4 py-8">
                <!-- Filtros y B√∫squeda -->
                <div class="bg-card-dark rounded-xl p-6 mb-8">
                    <div class="flex flex-col lg:flex-row gap-6">
                        <!-- Categor√≠as -->
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold mb-4 text-slate-200">Categor√≠as</h3>
                            <div class="flex flex-wrap gap-2">
                                <button class="category-button active bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-medium text-sm" data-category="all">
                                    Todos
                                </button>
                                <button class="category-button bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-medium text-sm" data-category="bullish">
                                    üü¢ Alcistas
                                </button>
                                <button class="category-button bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-medium text-sm" data-category="bearish">
                                    üî¥ Bajistas
                                </button>
                                <button class="category-button bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-medium text-sm" data-category="reversal">
                                    üîÑ Reversi√≥n
                                </button>
                                <button class="category-button bg-slate-600 hover:bg-slate-500 px-4 py-2 rounded-lg font-medium text-sm" data-category="continuation">
                                    ‚û°Ô∏è Continuaci√≥n
                                </button>
                            </div>
                        </div>

                        <!-- B√∫squeda -->
                        <div class="lg:w-80">
                            <h3 class="text-lg font-semibold mb-4 text-slate-200">B√∫squeda</h3>
                            <div class="relative">
                                <input type="text" id="searchInput" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white placeholder-slate-400 focus:ring-2 focus:ring-yellow-400 focus:border-transparent" placeholder="Buscar patrones...">
                                <svg class="w-5 h-5 text-slate-400 absolute right-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Grid de Patrones -->
                <div id="patternsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    <!-- Los patrones se generan din√°micamente -->
                </div>
            </div>
        </section>

    </main>

    <div id="tradeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-lg mx-4">
            <h3 class="text-xl font-semibold text-gold mb-4">Nuevo Trade</h3>
            <form id="tradeForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Fecha</label>
                        <input type="date" id="tradeDate" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Estrategia</label>
                        <select id="tradeStrategy" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                            <option value="regulares">Trades Regulares</option>
                            <option value="ema-macd">EMA + MACD</option>
                            <option value="contra-tendencia">Contra-Tendencia</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Direcci√≥n</label>
                        <select id="tradeDirection" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                            <option value="buy">Compra</option>
                            <option value="sell">Venta</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Contratos</label>
                        <input type="number" id="tradeContracts" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" required>
                    </div>
                </div>

                <!-- Secci√≥n de precios de entrada y salida -->
                <div class="bg-gray-800 p-4 rounded-lg border border-blue-500">
                    <h4 class="font-semibold text-blue-400 mb-3">üìä Proyeccion del Trade</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Precio Apertura</label>
                            <input type="number" id="entryPrice" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white" step="0.01" placeholder="2450.50" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Precio Cierre</label>
                            <input type="number" id="exitPrice" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white" step="0.01" placeholder="2465.30">
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-gray-700 rounded text-center">
                        <span class="text-sm text-gray-400">P&L Calculado: </span>
                        <span id="calculatedPnL" class="font-bold text-gold">$0.00</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Stop Loss (pips)</label>
                        <input type="number" id="tradeSL" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" step="0.1" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Take Profit (pips)</label>
                        <input type="number" id="tradeTP" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" step="0.1" required>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-2">Comentarios</label>
                    <textarea id="tradeComments" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white h-20" placeholder="Observaciones del trade..."></textarea>
                </div>

                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-profit hover:bg-green-600 px-4 py-2 rounded-lg font-medium">
                        Guardar Trade
                    </button>
                    <button type="button" id="cancelTradeBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Editar Trade -->
    <div id="editTradeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-lg mx-4">
            <h3 class="text-xl font-semibold text-blue-400 mb-4">‚úèÔ∏è Editar Trade</h3>
            <form id="editTradeForm" class="space-y-4">
                <input type="hidden" id="editTradeId">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Fecha</label>
                        <input type="date" id="editTradeDate" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Estrategia</label>
                        <select id="editTradeStrategy" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                            <option value="regulares">Trades Regulares</option>
                            <option value="ema-macd">EMA + MACD</option>
                            <option value="contra-tendencia">Contra-Tendencia</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Direcci√≥n</label>
                        <select id="editTradeDirection" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                            <option value="buy">Compra</option>
                            <option value="sell">Venta</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Contratos</label>
                        <input type="number" id="editTradeContracts" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" required>
                    </div>
                </div>
                <!-- PRECIOS - NUEVO DISE√ëO -->
                <div class="bg-gray-800 p-4 rounded-lg border border-yellow-500">
                    <h4 class="font-semibold text-yellow-400 mb-3">üí∞ Precios de Ejecuci√≥n</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Precio Apertura</label>
                            <input type="number" id="editOpenPrice" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white" step="0.01" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Precio Cierre</label>
                            <input type="number" id="editClosePrice" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg text-white" step="0.01">
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Stop Loss (pips)</label>
                        <input type="number" id="editTradeSL" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" step="0.1" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Take Profit (pips)</label>
                        <input type="number" id="editTradeTP" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" step="0.1" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Comentarios</label>
                    <textarea id="editTradeComments" class="w-full p-2 bg-gray-800 border border-gray-600 rounded-lg text-white h-20" placeholder="Observaciones del trade..."></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-medium">
                        Actualizar Trade
                    </button>
                    <button type="button" id="deleteTradeBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-medium">
                        üóëÔ∏è Eliminar
                    </button>
                    <button type="button" id="cancelEditTradeBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Retiros -->
    <div id="withdrawalModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold text-orange-400 mb-4">üí∞ Registrar Retiro</h3>
            <form id="withdrawalForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Fecha del Retiro</label>
                    <input type="date" id="withdrawalDate" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Cantidad ($)</label>
                    <input type="number" id="withdrawalAmount" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" min="1" step="0.01" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Concepto</label>
                    <input type="text" id="withdrawalConcept" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" placeholder="Gastos personales, inversi√≥n, etc.">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Notas</label>
                    <textarea id="withdrawalNotes" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white h-20" placeholder="Notas adicionales..."></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg font-medium">
                        Registrar Retiro
                    </button>
                    <button type="button" id="cancelWithdrawalBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium">
                        Cancelar
                    </button>
                </div>
            </form>

            <!-- Lista de retiros recientes -->
            <div class="mt-6 pt-4 border-t border-gray-700">
                <h4 class="font-semibold text-gray-300 mb-3">Retiros Recientes</h4>
                <div id="recentWithdrawals" class="space-y-2 max-h-32 overflow-y-auto">
                    <!-- Retiros ser√°n insertados aqu√≠ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar Capital -->
    <div id="addCapitalModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold text-profit mb-4">üí∞ Agregar Capital</h3>
            <form id="addCapitalForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Fecha</label>
                    <input type="date" id="addCapitalDate" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Cantidad a Agregar ($)</label>
                    <input type="number" id="addCapitalAmount" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" min="0.01" step="0.01" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Concepto</label>
                    <input type="text" id="addCapitalConcept" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white" placeholder="Dep√≥sito, ganancias reinvertidas, etc.">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Notas</label>
                    <textarea id="addCapitalNotes" class="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white h-20" placeholder="Notas adicionales..."></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-profit hover:bg-green-600 px-4 py-2 rounded-lg font-medium">
                        Agregar Capital
                    </button>
                    <button type="button" id="cancelAddCapitalBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-medium">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n para Reset -->
    <div id="resetConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-red-500 w-full max-w-md mx-4">
            <h3 class="text-xl font-semibold text-red-400 mb-4">‚ö†Ô∏è Confirmar Reset de Capital</h3>
            <div class="mb-6">
                <p class="text-gray-300 mb-4">¬øEst√°s seguro de resetear el capital?</p>
                <div class="bg-red-900 bg-opacity-30 p-3 rounded-lg border border-red-500">
                    <p class="text-red-400 font-semibold mb-2">Al aceptar se borrar√°n:</p>
                    <ul class="text-sm text-red-300 space-y-1">
                        <li>‚Ä¢ Todos los registros de trades</li>
                        <li>‚Ä¢ Historial de retiros y dep√≥sitos</li>
                        <li>‚Ä¢ Observaciones y estad√≠sticas</li>
                        <li>‚Ä¢ El capital se establecer√° en $0.00</li>
                    </ul>
                </div>
            </div>
            <div class="flex space-x-4">
                <button id="confirmResetBtn" class="flex-1 bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg font-medium">
                    S√≠, Resetear Todo
                </button>
                <button id="cancelResetBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-3 rounded-lg font-medium">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para Editar Niveles -->
    <div id="editLevelsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-trading-card p-6 rounded-lg border border-gray-700 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-xl font-semibold text-blue-400 mb-4">‚úèÔ∏è Actualizar Niveles Cr√≠ticos</h3>
            <form id="editLevelsForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Resistencias -->
                    <div>
                        <h4 class="font-semibold text-loss mb-3">üî¥ Resistencias</h4>
                        <div class="space-y-3" id="resistancesList">
                            <!-- Se llena din√°micamente -->
                        </div>
                        <button type="button" id="addResistanceBtn" class="mt-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm">
                            + Agregar Resistencia
                        </button>
                    </div>

                    <!-- Soportes -->
                    <div>
                        <h4 class="font-semibold text-profit mb-3">üü¢ Soportes</h4>
                        <div class="space-y-3" id="supportsList">
                            <!-- Se llena din√°micamente -->
                        </div>
                        <button type="button" id="addSupportBtn" class="mt-2 bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-sm">
                            + Agregar Soporte
                        </button>
                    </div>
                </div>

                <div class="flex space-x-4 pt-4 border-t border-gray-700">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg font-medium">
                        Actualizar Niveles
                    </button>
                    <button type="button" id="cancelEditLevelsBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 px-4 py-3 rounded-lg font-medium">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Patrones-->
    <div id="patternModal" class="fixed inset-0 modal-backdrop bg-black bg-opacity-70 hidden items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-xl border border-slate-600 w-full max-w-5xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <!-- Header del Modal -->
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="modalTitle" class="text-2xl font-bold text-yellow-400 mb-2"></h2>
                        <div id="modalBadges" class="flex gap-2"></div>
                    </div>
                    <button id="closeModal" class="text-slate-400 hover:text-white text-2xl font-bold p-2 hover:bg-slate-700 rounded-lg transition-colors">
                        ‚úï
                    </button>
                </div>

                <!-- Contenido del Modal -->
                <div id="modalContent" class="space-y-6">
                    <!-- Se genera din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip para comentarios -->
    <div id="commentTooltip" class="fixed bg-gray-900 text-white p-3 rounded-lg border border-gray-600 text-sm max-w-xs z-50 hidden shadow-lg">
        <div id="tooltipContent"></div>
    </div>

    <!-- Templates para Estrategias (ocultos, se usan con JavaScript) -->
    <div id="strategyTemplates" class="hidden">
        <!-- Template Trades Regulares OPTIMIZADO -->
        <div id="template-regulares" class="strategy-template">
            <h4 class="text-lg font-semibold text-blue-400 mb-4">üìà ESTRATEGIA 1: Trades Regulares (PRINCIPAL)</h4>

            <!-- FILTROS PREVENTIVOS -->
            <div class="mb-4 bg-red-900 bg-opacity-30 p-3 rounded-lg border border-red-500">
                <h5 class="font-semibold text-red-400 mb-2 text-sm">üö´ INVALIDACI√ìN INMEDIATA:</h5>
                <ul class="text-xs space-y-1">
                    <li>‚Ä¢ Williams %R 4H en zona extrema opuesta (-95 compras, -5 ventas)</li>
                    <li>‚Ä¢ MACD 4H girando en contra con histograma acelerando</li>
                    <li>‚Ä¢ Ruptura fuerte contra direcci√≥n con volumen 2x+</li>
                    <li>‚Ä¢ Stop Loss alcanzado (sin excepciones)</li>
                </ul>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- COMPRAS -->
                <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-500">
                    <h5 class="font-semibold text-green-400 mb-3">üü¢ SETUP COMPRAS</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-green-300">PASO 1 - Contexto 4H (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Estructura alcista validada (m√°x/m√≠n ascendentes)</li>
                                <li>‚Ä¢ Williams %R saliendo de -80/-60 o rebote en -50‚Üë</li>
                                <li>‚Ä¢ EMA 21 > EMA 50 o precio usando EMA 21 de soporte</li>
                                <li>‚Ä¢ MACD alcista sin divergencia</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-green-300">PASO 2 - Setup 15M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Rechazo en soporte o rompimiento de resistencia</li>
                                <li>‚Ä¢ Williams %R entre -80/-50 movi√©ndose arriba</li>
                                <li>‚Ä¢ Vela con mecha larga (4+ pips) + cuerpo verde</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-green-300">PASO 3 - Confirmaci√≥n 3M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Williams %R girando -70‚Üí-50‚Üë</li>
                                <li>‚Ä¢ MACD histograma verde creciente 2+ velas</li>
                                <li>‚Ä¢ Vela con volumen 1.2x+ validando rebote/ruptura</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- VENTAS -->
                <div class="bg-red-900 bg-opacity-20 p-4 rounded-lg border border-red-500">
                    <h5 class="font-semibold text-red-400 mb-3">üî¥ SETUP VENTAS</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-red-300">PASO 1 - Contexto 4H (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Estructura bajista validada (m√°x/m√≠n descendentes)</li>
                                <li>‚Ä¢ Williams %R saliendo de -20/-40 o rebote en -50‚Üì</li>
                                <li>‚Ä¢ EMA 21 < EMA 50 o precio usando EMA 21 de resistencia</li>
                                <li>‚Ä¢ MACD bajista sin divergencia</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-red-300">PASO 2 - Setup 15M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Rechazo en resistencia o rompimiento de soporte</li>
                                <li>‚Ä¢ Williams %R entre -20/-50 movi√©ndose abajo</li>
                                <li>‚Ä¢ Vela con mecha superior (4+ pips) + cuerpo rojo</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-red-300">PASO 3 - Confirmaci√≥n 3M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Williams %R girando -30‚Üí-50‚Üì</li>
                                <li>‚Ä¢ MACD histograma rojo creciente 2+ velas</li>
                                <li>‚Ä¢ Vela con volumen 1.2x+ validando rechazo/ruptura</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONFLUENCIAS -->
            <div class="mt-4 bg-purple-900 bg-opacity-20 p-3 rounded-lg border border-purple-400">
                <h5 class="font-semibold text-purple-400 mb-2">‚ö° CONFLUENCIAS DE ALTA PROBABILIDAD:</h5>
                <ul class="text-xs space-y-1">
                    <li>‚Ä¢ Williams %R alineado en 4H, 15M y 3M</li>
                    <li>‚Ä¢ MACD 15M y 3M sincronizados</li>
                    <li>‚Ä¢ Nivel S/R o l√≠nea de tendencia clave</li>
                    <li>‚Ä¢ Vela 3M confirmatoria con volumen 1.5x+</li>
                    <li>‚Ä¢ Divergencia Williams %R vs precio</li>
                </ul>
            </div>

            <div class="mt-4 bg-blue-900 bg-opacity-20 p-3 rounded-lg border border-blue-400">
                <p class="text-sm"><strong>ENTRADA:</strong> Despu√©s de la vela 3M confirmatoria validando break o rebote en 15M.</p>
            </div>
        </div>


        <!-- Template EMA + MACD -->
        <div id="template-ema-macd" class="strategy-template">
            <h4 class="text-lg font-semibold text-purple-400 mb-4">üìä ESTRATEGIA 2: EMA + MACD + CONFLUENCIA</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- COMPRAS EMA+MACD -->
                <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-500">
                    <h5 class="font-semibold text-green-400 mb-3">üü¢ SETUP COMPRAS</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-green-300">PASO 1 - Contexto 4H:</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ MACD sin divergencia bajista + histograma verde creciendo</li>
                                <li>‚Ä¢ No en ca√≠da libre de +3 d√≠as consecutivos</li>
                                <li>‚Ä¢ Precio supera +2 resistencias y se mantiene como soporte</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-green-300">PASO 2 - Se√±al 1H (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ L√≠neas MACD por cruzar hacia direcci√≥n alcista</li>
                                <li>‚Ä¢ Precio rompe o rebota en zona de SOPORTE</li>
                                <li>‚Ä¢ Precio encima o rebota en EMA 21 por 3+ velas</li>
                                <li>‚Ä¢ EMA 21 cruza EMA 50 al alza (Opcional)</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-green-300">PASO 3 - Confirmaci√≥n 15M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Histograma MACD creciendo 2+ velas consecutivas</li>
                                <li>‚Ä¢ Precio encima de ambas EMAs por 2+ velas</li>
                                <li>‚Ä¢ Vela rebota en EMA 21 o 50 con histograma verde</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- VENTAS EMA+MACD -->
                <div class="bg-red-900 bg-opacity-20 p-4 rounded-lg border border-red-500">
                    <h5 class="font-semibold text-red-400 mb-3">üî¥ SETUP VENTAS</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-red-300">PASO 1 - Contexto 4H:</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ MACD con divergencia bajista e histograma rojo</li>
                                <li>‚Ä¢ No en subida libre de +3 d√≠as consecutivos</li>
                                <li>‚Ä¢ Precio rompe +2 soportes y rebota en √∫ltimo como resistencia</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-red-300">PASO 2 - Se√±al 1H (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ L√≠neas MACD por cruzar hacia direcci√≥n bajista</li>
                                <li>‚Ä¢ Precio rompe o es rechazado en zona de RESISTENCIA</li>
                                <li>‚Ä¢ Precio debajo o rebota en EMA 21 por 3+ velas</li>
                                <li>‚Ä¢ EMA 21 cruza EMA 50 a la baja (Opcional)</li>
                            </ul>
                        </div>
                        <div>
                            <h6 class="font-medium text-red-300">PASO 3 - Confirmaci√≥n 15M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Histograma MACD decreciendo 2+ velas consecutivas</li>
                                <li>‚Ä¢ Precio debajo de ambas EMAs por 2+ velas</li>
                                <li>‚Ä¢ Vela rechaza EMA 21 o 50 con histograma rojo</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4 bg-purple-900 bg-opacity-20 p-3 rounded-lg border border-purple-400">
                <p class="text-sm"><strong>ENTRADA:</strong> Siguiente vela 5M despu√©s de confirmaci√≥n</p>
            </div>
        </div>

        <!-- Template Contra-Tendencia ACTUALIZADO -->
        <div id="template-contra-tendencia" class="strategy-template">
            <h4 class="text-lg font-semibold text-orange-400 mb-4">‚ö° ESTRATEGIA 3: Contra Tendencia Flexible</h4>

            <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div class="bg-red-900 bg-opacity-30 p-3 mb-3 rounded-lg border border-red-500">
                    <h5 class="font-semibold text-red-400 mb-2 text-sm">üö® INVALIDACI√ìN INMEDIATA (Ambos setups):</h5>
                    <ul class="text-xs space-y-1">
                        <li>‚Ä¢ Williams %R 5M regresa 80% hacia extremo original en 2 velas consecutivas</li>
                        <li>‚Ä¢ MACD 4H acelera fuertemente contra posici√≥n (histograma expandi√©ndose)</li>
                        <li>‚Ä¢ Volumen 5M cae por debajo del promedio por 3+ velas post-entrada</li>
                        <li>‚Ä¢ Ruptura nivel cr√≠tico 15M con volumen &gt;2x en direcci√≥n contraria</li>
                    </ul>
                </div>

                <div class="bg-yellow-900 bg-opacity-20 p-3 mb-3 rounded-lg border border-yellow-500">
                    <h5 class="font-semibold text-yellow-400 mb-2 text-sm">üéØ USAR CUANDO:</h5>
                    <ul class="text-xs space-y-1">
                        <li>‚Ä¢ Williams %R 15M en extremos: &lt;-75 o &gt;-25 por 2+ velas consecutivas</li>
                        <li>‚Ä¢ MACD 1H: Aplanamiento en l√≠nea se√±al + debilidad en Histograma</li>
                        <li>‚Ä¢ Tendencia clara 4H: precio cerca de nivel t√©cnico cr√≠tico S/R</li>
                        <li>‚Ä¢ Mechas largas 15M: en zonas S/R con volumen en retroceso</li>
                        <li>‚Ä¢ Agotamiento visible 4H: precio en extremos de rango establecido</li>
                    </ul>
                </div>
            </section>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- COMPRAS - Rebote Agotamiento Bajista -->
                <div class="bg-green-900 bg-opacity-20 p-4 rounded-lg border border-green-500">
                    <h5 class="font-semibold text-green-400 mb-3">üü¢ COMPRAS - Rebote Agotamiento Bajista</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-green-300">üìä Contexto 4H - Verificaci√≥n:</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Tendencia bajista: EMA 21 debajo EMA 50 por 24H+</li>
                                <li>‚Ä¢ No ca√≠da libre: MACD 4H sin divergencia bajista fuerte</li>
                                <li>‚Ä¢ Zona soportes fuerte: m√≠nimo de rango diario establecido</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-green-300">üîç Filtros 1H - Validaci√≥n (TODAS):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ MACD: Divergencia alcista O l√≠nea se√±al aplan√°ndose/girando</li>
                                <li>‚Ä¢ Mechas rechazo: 3+ pips por debajo en zona soporte cr√≠tico</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-green-300">‚ö° Pre-setup 15M (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Agotamiento extremo: Williams %R &lt;-75 por 2+ velas consecutivas</li>
                                <li>‚Ä¢ Nivel cr√≠tico validado: Retesteo 2+ veces (velas verdes &gt; rojas)</li>
                                <li>‚Ä¢ Patr√≥n vela: Martillo, doji estrella o mecha &gt;50% cuerpo</li>
                                <li>‚Ä¢ MACD 15M: L√≠neas cambiando direcci√≥n o divergencia alcista</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-green-300">üéØ Trigger 5M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Williams girando: Saliendo de &lt;-80 hacia &gt;-70 en ascenso</li>
                                <li>‚Ä¢ Volumen explosivo: Superior 1.3x promedio √∫ltimas 10 velas</li>
                                <li>‚Ä¢ MACD: L√≠neas se√±al e Histograma en direcci√≥n del trade</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- VENTAS - Rechazo Agotamiento Alcista -->
                <div class="bg-red-900 bg-opacity-20 p-4 rounded-lg border border-red-500">
                    <h5 class="font-semibold text-red-400 mb-3">üî¥ VENTAS - Rechazo Agotamiento Alcista</h5>
                    <div class="space-y-3 text-sm">
                        <div>
                            <h6 class="font-medium text-red-300">üìä Contexto 4H - Verificaci√≥n:</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Tendencia alcista: EMA 21 encima EMA 50 por 24H+</li>
                                <li>‚Ä¢ No subida libre: MACD 4H sin divergencia alcista fuerte</li>
                                <li>‚Ä¢ Zona resistencias fuerte: m√°ximo de rango diario establecido</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-red-300">üîç Filtros 1H - Validaci√≥n (1 de 2 m√≠n):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ MACD: Divergencia bajista O l√≠nea se√±al aplan√°ndose/girando</li>
                                <li>‚Ä¢ Mechas rechazo: 4+ pips por encima llegando a resistencia</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-red-300">‚ö° Pre-setup 15M (3 de 4):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Agotamiento extremo: Williams %R &gt;-25 por 2+ velas consecutivas</li>
                                <li>‚Ä¢ Nivel cr√≠tico validado: Retesteo 2+ veces (velas rojas &gt; verdes)</li>
                                <li>‚Ä¢ Patr√≥n vela: Martillo invertido, doji estrella &gt;50% cuerpo</li>
                                <li>‚Ä¢ MACD 15M: L√≠neas cambiando direcci√≥n o divergencia bajista</li>
                            </ul>
                        </div>

                        <div>
                            <h6 class="font-medium text-red-300">üéØ Trigger 5M (2 de 3):</h6>
                            <ul class="mt-1 space-y-1 text-xs">
                                <li>‚Ä¢ Williams girando: Saliendo de &gt;-20 hacia &lt;-30 en descenso</li>
                                <li>‚Ä¢ Volumen explosivo: Superior 1.3x promedio √∫ltimas 10 velas</li>
                                <li>‚Ä¢ MACD: L√≠neas se√±al e Histograma en direcci√≥n del trade</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Se√±ales de Refuerzo -->
            <div class="mt-4 bg-purple-900 bg-opacity-20 p-3 rounded-lg border border-purple-400">
                <h5 class="font-semibold text-purple-400 mb-2">üîÑ SE√ëALES DE REFUERZO ADICIONAL (opcional):</h5>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                    <div>
                        <h6 class="font-medium text-purple-300">Para COMPRAS:</h6>
                        <ul class="space-y-1 text-xs">
                            <li>‚Ä¢ Williams 15M girando arriba ‚Üí +25% contratos</li>
                            <li>‚Ä¢ Ruptura EMA 21 en 5M con volumen ‚Üí TP2 +10 pips</li>
                            <li>‚Ä¢ MACD 1H cruce alcista ‚Üí +50% posici√≥n</li>
                            <li>‚Ä¢ Divergencia Williams %R 15M (menos sobrevendido)</li>
                        </ul>
                    </div>
                    <div>
                        <h6 class="font-medium text-red-300">Para VENTAS:</h6>
                        <ul class="space-y-1 text-xs">
                            <li>‚Ä¢ Williams 15M girando abajo ‚Üí +25% contratos</li>
                            <li>‚Ä¢ Ruptura EMA 21 en 5M con volumen ‚Üí TP2 +10 pips</li>
                            <li>‚Ä¢ MACD 1H cruce bajista ‚Üí +50% posici√≥n</li>
                            <li>‚Ä¢ Divergencia Williams %R 15M (menos sobrecomprado)</li>
                        </ul>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <!-- Bot√≥n flotante para activar panel -->
    <button id="confluenceToggle" class="fixed top-24 md:top-16 right-4 z-50 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 hover:scale-105">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
    </button>

    <!-- Panel de confluencia (inicialmente oculto) -->
    <div id="confluencePanel" class="fixed top-4 right-4 z-40 w-96 bg-gray-900 text-white rounded-lg shadow-2xl p-6 transform translate-x-full transition-transform duration-300 max-h-screen overflow-y-auto border border-gray-700">

        <!-- Header -->
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold">An√°lisis de Confluencia</h3>
            <button id="confluenceClose" class="text-gray-400 hover:text-white">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Reglas de eficiencia (colapsible) -->
        <div class="border-t border-gray-700 pt-4 mt-4">
            <button id="toggleRules" class="w-full text-left text-sm font-medium mb-2 flex justify-between items-center hover:bg-gray-800 p-2 rounded">
                <span>üìã Reglas de Eficiencia</span>
                <svg id="rulesArrow" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="rulesContent" class="hidden text-xs space-y-2">
                <!-- Las reglas se generan din√°micamente con JavaScript -->
            </div>
        </div>

        <!-- Patrones de Velas + Volumen (colapsible) -->
        <div class="border-t border-gray-700 pt-4">
            <button id="toggleReference" class="w-full text-left text-sm font-medium mb-2 flex justify-between items-center hover:bg-gray-800 p-2 rounded">
                <span>üìä Patrones de Velas + Volumen</span>
                <svg id="referenceArrow" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="referenceTable" class="hidden text-xs space-y-3 max-h-64 overflow-y-auto">
                <!-- Los patrones se generan din√°micamente con JavaScript -->
            </div>
        </div>

        <!-- Checklist de factores -->
        <div class="mb-6">
            <h4 class="text-md font-semibold mb-3">Factores de Confluencia</h4>
            <div id="confluenceChecklist" class="space-y-2">
                <!-- Se genera din√°micamente con JavaScript -->
            </div>
        </div>

        <!-- Indicador de probabilidad -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm">Probabilidad de √©xito</span>
                <span id="probabilityText" class="text-lg font-bold">0%</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-3">
                <div id="probabilityBar" class="h-3 rounded-full transition-all duration-500 bg-red-500" style="width: 0%"></div>
            </div>
            <div id="recommendation" class="text-center mt-2 text-sm font-medium text-red-400">NO OPERAR</div>
        </div>

        <!-- Botones de acci√≥n -->
        <div class="flex space-x-2 mb-4">
            <button id="resetFactors" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 px-4 rounded transition-colors">
                Reset
            </button>
            <button id="saveAnalysis" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded transition-colors">
                Guardar
            </button>
        </div>
    </div>


</body>

<script src="firebase-app.js"></script>
<script src="confluence.js"></script>
<script src="patrones.js"></script>

</html>
